name: PR Source Validation

on:
  pull_request:
    branches: [main, master, development, dev]

jobs:
  validate-source:
    runs-on: ubuntu-latest
    steps:
      - name: Check PR source branch
        run: |
          SOURCE="${{ github.head_ref }}"
          TARGET="${{ github.base_ref }}"

          # PRs to main/master must come from development, dev, or hotfix/
          if [[ "$TARGET" == "main" || "$TARGET" == "master" ]]; then
            if [[ "$SOURCE" != "development" && "$SOURCE" != "dev" && ! "$SOURCE" =~ ^hotfix/ ]]; then
              echo "❌ ERROR: PRs to $TARGET must originate from development, dev, or a hotfix/ branch."
              echo "Source branch: $SOURCE"
              exit 1
            fi
          fi

          # PRs to development/dev must come from feature/, bugfix/, refactor/, or hotfix/
          if [[ "$TARGET" == "development" || "$TARGET" == "dev" ]]; then
            if [[ ! "$SOURCE" =~ ^(feature/|bugfix/|hotfix/|refactor/) ]]; then
              echo "❌ ERROR: PRs to $TARGET must originate from a feature/, bugfix/, or hotfix/ branch."
              echo "Source branch: $SOURCE"
              exit 1
            fi
          fi

          echo "✅ PR source validated: $SOURCE → $TARGET"
